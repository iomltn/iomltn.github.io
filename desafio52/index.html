<html>
	<head>
		<title>Desafio 52 Semanas</title>
		<style>
		table {	
			margin: 0 auto;
			border-collapse: collapse;
			font-family: arial;
		}
		table th, td {
			padding: 5px;
		}
		table td {
			text-align: center;
		}
		.semanaAtual {
			background-color: yellow;
		}
		.valorAcumulado {
			color: gray;
		}
		small {
			font-size: 10px;
		}
		</style>
		<script>
		var Desafio = function() {
			this.getDomingo = function(data) {
				var novaData = new Date(data.getFullYear(), data.getMonth(), data.getDate());
				while (novaData.getDay() != 0) {
					novaData.setDate(novaData.getDate() - 1);
				}
				return novaData;
			}
			this.mesmaSemana = function(data1, data2) {
				var dataDomingo1 = this.getDomingo(data1);
				var dataDomingo2 = this.getDomingo(data2);
				dataDomingo2.setDate(dataDomingo2.getDate() + 7);
				if (dataDomingo1.getDate() == dataDomingo2.getDate() &&
						dataDomingo1.getMonth() == dataDomingo2.getMonth() &&
							dataDomingo1.getFullYear() == dataDomingo2.getFullYear()) {
					return true;
				} else {
					return false;
				}
			}
			this.getDataFormatada = function(data) {
				var dia = data.getDate();
				var mes = data.getMonth() + 1;
				var ano = data.getFullYear();
				dia = dia < 10 ? "0" + dia : dia;
				mes = mes < 10 ? "0" + mes : mes;
				return dia + "/" + mes + "/" + ano;				
			}
			this.iniciar = function() {
				var dataPtn = /\d{2}\/\d{2}\/\d{4}/i;
				var dataStr = prompt("Digite a data que você começou/começará (dd/mm/yyyy):", "21/08/2017");
				while (!dataPtn.test(dataStr)) {
					dataStr = prompt("Formato inválido!\nDigite a data que você começou/começará (dd/mm/yyyy):", "");
				}
				var dataArray = dataStr.split("/");
				var data = new Date(dataArray[2], dataArray[1] - 1, dataArray[0]);
			
				//retornando até o domingo anterior
				while (data.getDay() != 0) {
					data.setDate(data.getDate() - 1);
				}
				
				var valorStr = prompt("Digite o valor inicial (use apenas números e o vírgula):", "5");
				if (valorStr.indexOf(",") != -1) {
					valorStr = valorStr.replace(",", ".");
				}
				while (isNaN(valorStr)) {
					valorStr = prompt("Valor inválido!\nDigite o valor inicial (use apenas números e o vírgula):", "");
					if (valorStr.indexOf(",") != -1) {
						valorStr = valorStr.replace(",", ".");
					}
				}

				var valor = parseFloat(valorStr);
				var valorAcumulado = 0.0;

				var tabela = document.getElementsByTagName("table")[0];

				for (var i = 1; i <= 52; i++) {
					var periodo = this.getDataFormatada(data);
					data.setDate(data.getDate() + 6);
					var vencimento = this.getDataFormatada(data);
					periodo += " - " + vencimento;
					data.setDate(data.getDate() + 1);

					var valorSemana = valor + (i - 1) * valor;
					valorAcumulado += valorSemana;

					var valorSemanaStr = valorSemana.toFixed(2);
					valorSemanaStr = "R$ " + valorSemanaStr.replace(".", ",");

					var valorAcumuladoStr = valorAcumulado.toFixed(2);
					valorAcumuladoStr = "R$ " + valorAcumuladoStr.replace(".", ",");

					var tr = document.createElement("tr");
					var tdSemana = document.createElement("td");
					var tdPeriodo = document.createElement("td");
					var tdVencimento = document.createElement("td");
					var tdDepositar = document.createElement("td");
					var tdAcumulado = document.createElement("td");
					if (this.mesmaSemana(data, new Date())) {
						tr.setAttribute("class", "semanaAtual");
					}
					tdAcumulado.setAttribute("class", "valorAcumulado");
					tdSemana.innerHTML = i;
					tdPeriodo.innerHTML = periodo;
					tdVencimento.innerHTML = vencimento;
					tdDepositar.innerHTML = valorSemanaStr;
					tdAcumulado.innerHTML = valorAcumuladoStr;

					tr.appendChild(tdSemana);
					tr.appendChild(tdPeriodo);
					tr.appendChild(tdVencimento);
					tr.appendChild(tdDepositar);
					tr.appendChild(tdAcumulado);
					tabela.appendChild(tr);
				}
			}
		};
		window.onload = function() {
			var desafio = new Desafio();
			desafio.iniciar();
		}
		</script>
	</head>
	<body>
		<table border="1">
			<tr>
				<th colspan="5">
					<h1>Desafio 52 Semanas <small>by iomltn@gmail.com</small></h1>
				</th>
			</tr>
			<tr>
				<th>Semana</th>
				<th>Período</th>
				<th>Vencimento</th>
				<th>Valor a depositar</th>
				<th>Valor Acumulado</th>
			</tr>
		</table>
	</body>
</html>
