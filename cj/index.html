<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<title>Contribuição Justa</title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width,scale"/>
		<style>
		table {
			margin: 0 auto;
			border-collapse: collapse;
			width-min: 300px;
		}
		h1, p {
			text-align: center;
		}
		td, th {
			padding: 5px;
		}
		</style>
		<script>	
		function atualizaValores(valor) {
			var tabelacontribuintes = document.getElementById("tabela-contribuintes");
			var trs = tabelacontribuintes.getElementsByTagName("tr");
			var soma = 0;
			for (var i = 0; i < trs.length; i++) {
				if (i == 0) continue;
				soma += parseFloat(trs[i].getElementsByTagName("td")[1].innerHTML.replace("R$ ", "").replace(",", "."));
			}
			for (var i = 0; i < trs.length; i++) {
				if (i == 0) continue;
				salario = parseFloat(trs[i].getElementsByTagName("td")[1].innerHTML.replace("R$ ", "").replace(",", "."));
				trs[i].getElementsByTagName("td")[2].innerHTML = "R$ " + ((salario * valor) / soma).toFixed(2).replace(".", ",");
			}
		}

		function adicionar() {
			var valor = document.getElementById("valor").value;
			var tabelacontribuintes = document.getElementById("tabela-contribuintes");
			var contribuinte = document.getElementById("contribuinte").value;
			var salario = document.getElementById("salario").value;
			if (contribuinte != "" && parseInt(salario) > 0) {
				var tr = document.createElement("tr");
				var td = document.createElement("td");
				td.innerHTML = contribuinte;
				tr.appendChild(td);
				td = document.createElement("td");
				td.innerHTML = ("R$ " + parseFloat(salario.replace(",", ".")).toFixed(2)).replace(".", ",");
				tr.appendChild(td);
				td = document.createElement("td");
				td.innerHTML = "...";
				tr.appendChild(td);
				tabelacontribuintes.appendChild(tr);
				td = document.createElement("td");
				var btn = document.createElement("button");
				btn.innerHTML = "X";
				btn.addEventListener("click", function() {
					tabelacontribuintes.removeChild(tr);
					atualizaValores(valor);
				});
				td.appendChild(btn);
				tr.appendChild(td);
				document.getElementById("contribuinte").value = "";
				document.getElementById("salario").value = "";

				atualizaValores(valor);
			}
		}
        function configTeclado() {
            var valor = document.getElementById("valor");
            var contribuinte = document.getElementById("contribuinte");
            var salario = document.getElementById("salario");
            valor.addEventListener("keyup", function(e) {
                if (e.keyCode == "13") {
                    contribuinte.focus();
                }
            });
            contribuinte.addEventListener("keyup", function(e) {
                if(e.keyCode == "13") {
                    salario.focus();
                }
            });
            salario.addEventListener("keyup", function(e) {
                if (e.keyCode == "13") {
                    adicionar();
                    contribuinte.focus();
                }
            });
        }
        window.onload = function() {
            configTeclado();
        }
		</script>
	</head>
	<body>
		<h1>Contribuição Justa</h1>
		<p>Objetivo: Distribuir o valor da contribuição individual de forma proporcional ao salário de cada um.</p>
		<table>
			<tr>
				<td colspan="2">Valor à Contribuir (Total)</td>
			</tr>
			<tr>
				<td colspan="2"><input type="text" id="valor"/></td>
			</tr>
			<tr>
				<td>Contribuinte</td>
				<td>Salário</td>
				<td></td>
			</tr>
			<tr>
				<td><input type="text" id="contribuinte"/></td>
				<td><input type="text" id="salario"/></td>
			</tr>
			<tr>
				<td colspan="2"><button onclick="adicionar()">Adicionar</button></td>
			</tr>
		</table>
		<table id="tabela-contribuintes" border="1">
			<tr>
				<th>Contribuinte</th>
				<th>Salario</th>
				<th colspan="2">Valor à Contribuir</th>
			</tr>
		</table>
		<p><small>by <a href="http://api.whatsapp.com/send?1=pt_BR&phone=5588988418921" target="_blank">Milton Rodrigues</a> - iomltn@gmail.com</small></p>
	</body>
</html>
