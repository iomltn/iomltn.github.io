<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta charset="utf-8"/>
		<title>Massa Molar</title>
		<meta name="viewport" content="width=device-width">
		<link rel="stylesheet" type="text/css" href="../css/global.css"/>
		<style>
		body {
			font-family: arial;
			background: lightgray;
			background-image: url("fundo.png");
		}
		h1 {
			font-size: 40px;
			color: white;
		}
		#expressao, #mm{
			padding: 5px;
			font-size: 30px;
			border: solid 2px gray;
			border-radius: 10px;
			padding: 5px;
			outline: none;
			text-align: center;
			width: 275px
		}
		#container {
			margin: 0 auto;
			overflow: auto;
			text-align: center;
		}
		#container * {
			margin: 5px;
		}
		table {
			background: white;
			display: inline-block;
			clear: both;
			text-align: center;
			clear: both;
			font-size: 18px;
			border-collapse: collapse;
			border-radius: 10px;
			overflow: auto;
		}
		table th {
			color: gray;
		}
		table td, th {
			padding: 5px;
		}
		table td button {
			margin: 5px;
			border: none;
			background: black;
			color: white;
			vertical-align: middle;
			border-radius: 10px;
			cursor: pointer;
			font-weight: bold;
		}
		.esquerda {
			text-align: left;
		}
		.direita {
			text-align: right;
		}
		span, small {
			color: white;
		}
		a{
			color: white;	
		}
		</style>
		<script type="text/javascript" src="../js/global.js"></script>
		<script type="text/javascript" src="../js/menubar.js"></script>
		<script type="text/javascript" src="../js/footbar.js"></script>
		<script>
		var elementos = [
			{"z": 1, "simbolo": "H", "nome": "Hidrogênio", "mm":1.00794},
			{"z": 2, "simbolo": "He", "nome": "Hélio", "mm":4.002602},
			{"z": 3, "simbolo": "Li", "nome": "Lítio", "mm":6.941},
			{"z": 4, "simbolo": "Be", "nome": "Berílio", "mm":9.012182},
			{"z": 5, "simbolo": "B", "nome": "Boro", "mm":10.811},
			{"z": 6, "simbolo": "C", "nome": "Carbono", "mm":12.0107},
			{"z": 7, "simbolo": "N", "nome": "Nitrogênio", "mm":14.0067},
			{"z": 8, "simbolo": "O", "nome": "Oxigênio", "mm":15.9994},
			{"z": 9, "simbolo": "F", "nome": "Flúor", "mm":18.9984032},
			{"z": 10, "simbolo": "Ne", "nome": "Neônio", "mm":20.1797},
			{"z": 11, "simbolo": "Na", "nome": "Sódio", "mm":22.98976928},
			{"z": 12, "simbolo": "Mg", "nome": "Magnésio", "mm":24.305},
			{"z": 13, "simbolo": "Al", "nome": "Alumínio", "mm":26.9815386},
			{"z": 14, "simbolo": "Si", "nome": "Silício", "mm":28.0855},
			{"z": 15, "simbolo": "P", "nome": "Fósforo", "mm":30.973762},
			{"z": 16, "simbolo": "S", "nome": "Enxofre", "mm":32.065},
			{"z": 17, "simbolo": "Cl", "nome": "Cloro", "mm":35.453},
			{"z": 18, "simbolo": "Ar", "nome": "Argônio", "mm":39.948},
			{"z": 19, "simbolo": "K", "nome": "Potássio", "mm":39.0983},
			{"z": 20, "simbolo": "Ca", "nome": "Cálcio", "mm":40.078},
			{"z": 21, "simbolo": "Sc", "nome": "Escândio", "mm":44.955912},
			{"z": 22, "simbolo": "Ti", "nome": "Titânio", "mm":47.867},
			{"z": 23, "simbolo": "V", "nome": "Vanádio", "mm":50.9415},
			{"z": 24, "simbolo": "Cr", "nome": "Cromo", "mm":51.9961},
			{"z": 25, "simbolo": "Mn", "nome": "Manganês", "mm":54.938045},
			{"z": 26, "simbolo": "Fe", "nome": "Ferro", "mm":55.845},
			{"z": 27, "simbolo": "Co", "nome": "Cobalto", "mm":58.933195},
			{"z": 28, "simbolo": "Ni", "nome": "Níquel", "mm":58.6934},
			{"z": 29, "simbolo": "Cu", "nome": "Cobre", "mm":63.546},
			{"z": 30, "simbolo": "Zn", "nome": "Zinco", "mm":65.38},
			{"z": 31, "simbolo": "Ga", "nome": "Gálio", "mm":69.723},
			{"z": 32, "simbolo": "Ge", "nome": "Germânio", "mm":72.63},
			{"z": 33, "simbolo": "As", "nome": "Arsênio", "mm":74.9216},
			{"z": 34, "simbolo": "Se", "nome": "Selênio", "mm":78.96},
			{"z": 35, "simbolo": "Br", "nome": "Bromo", "mm":79.904},
			{"z": 36, "simbolo": "Kr", "nome": "Cripitônio", "mm":83.798},
			{"z": 37, "simbolo": "Rb", "nome": "Rubídio", "mm":85.4678},
			{"z": 38, "simbolo": "Sr", "nome": "Estrôncio", "mm":87.62},
			{"z": 39, "simbolo": "Y", "nome": "Ítrio", "mm":88.90585},
			{"z": 40, "simbolo": "Zr", "nome": "Zircônio", "mm":91.224},
			{"z": 41, "simbolo": "Nb", "nome": "Nióbio", "mm":92.90638},
			{"z": 42, "simbolo": "Mo", "nome": "Molibdênio", "mm":95.96},
			{"z": 43, "simbolo": "Tc", "nome": "Tecnécio", "mm":98},
			{"z": 44, "simbolo": "Ru", "nome": "Rutênio", "mm":101.07},
			{"z": 45, "simbolo": "Rh", "nome": "Ródio", "mm":102.9055},
			{"z": 46, "simbolo": "Pd", "nome": "Paládio", "mm":106.42},
			{"z": 47, "simbolo": "Ag", "nome": "Prata", "mm":107.8682},
			{"z": 48, "simbolo": "Cd", "nome": "Cádmio", "mm":112.411},
			{"z": 49, "simbolo": "In", "nome": "Índio", "mm":114.818},
			{"z": 50, "simbolo": "Sn", "nome": "Estanho", "mm":118.71},
			{"z": 51, "simbolo": "Sb", "nome": "Antimônio", "mm":121.76},
			{"z": 52, "simbolo": "Te", "nome": "Telúrio", "mm":127.6},
			{"z": 53, "simbolo": "I", "nome": "Iodo", "mm":126.90447},
			{"z": 54, "simbolo": "Xe", "nome": "Xenônio", "mm":131.293},
			{"z": 55, "simbolo": "Cs", "nome": "Césio", "mm":132.9054519},
			{"z": 56, "simbolo": "Ba", "nome": "Bário", "mm":137.327},
			{"z": 72, "simbolo": "Hf", "nome": "Háfnio", "mm":178.49},
			{"z": 73, "simbolo": "Ta", "nome": "Tântalo", "mm":180.94788},
			{"z": 74, "simbolo": "W", "nome": "Tungstênio", "mm":183.84},
			{"z": 75, "simbolo": "Re", "nome": "Rênio", "mm":186.207},
			{"z": 76, "simbolo": "Os", "nome": "Ósmio", "mm":190.23},
			{"z": 77, "simbolo": "Ir", "nome": "Irídio", "mm":192.217},
			{"z": 78, "simbolo": "Pt", "nome": "Platina", "mm":195.084},
			{"z": 79, "simbolo": "Au", "nome": "Ouro", "mm":196.966569},
			{"z": 80, "simbolo": "Hg", "nome": "Mercúrio", "mm":200.59},
			{"z": 81, "simbolo": "Tl", "nome": "Tálio", "mm":204.3833},
			{"z": 82, "simbolo": "Pb", "nome": "Chumbo", "mm":207.2},
			{"z": 83, "simbolo": "Bi", "nome": "Bismuto", "mm":208.9804},
			{"z": 84, "simbolo": "Po", "nome": "Polônio", "mm":209},
			{"z": 85, "simbolo": "At", "nome": "Astato", "mm":210},
			{"z": 86, "simbolo": "Rn", "nome": "Radônio", "mm":222},
			{"z": 87, "simbolo": "Fr", "nome": "Frâncio", "mm":223},
			{"z": 88, "simbolo": "Ra", "nome": "Rádio", "mm":226},
			{"z": 104, "simbolo": "Rf", "nome": "Rutherfórdio", "mm":267},
			{"z": 105, "simbolo": "Db", "nome": "Dúbnio", "mm":268},
			{"z": 106, "simbolo": "Sg", "nome": "Seabórgio", "mm":271},
			{"z": 107, "simbolo": "Bh", "nome": "Bóhrio", "mm":272},
			{"z": 108, "simbolo": "Hs", "nome": "Hássio", "mm":270},
			{"z": 109, "simbolo": "Mt", "nome": "Meitnério", "mm":276},
			{"z": 110, "simbolo": "Ds", "nome": "Darmstádio", "mm":281},
			{"z": 111, "simbolo": "Rg", "nome": "Roentgênio", "mm":280},
			{"z": 112, "simbolo": "Cn", "nome": "Copernício", "mm":285},
			{"z": 113, "simbolo": "Uut", "nome": "Ununtrio", "mm":284},
			{"z": 114, "simbolo": "Fl", "nome": "Fleróvio", "mm":289},
			{"z": 115, "simbolo": "Uup", "nome": "Ununpentio", "mm":288},
			{"z": 116, "simbolo": "Lv", "nome": "Livermório", "mm":293},
			{"z": 117, "simbolo": "Uus", "nome": "Ununséptio", "mm":294},
			{"z": 118, "simbolo": "Uuo", "nome": "Ununóctio", "mm":294},
			{"z": 57, "simbolo": "La", "nome": "Lantânio", "mm":138.90547},
			{"z": 58, "simbolo": "Ce", "nome": "Cério", "mm":140.116},
			{"z": 59, "simbolo": "Pr", "nome": "Praseodímio", "mm":140.90765},
			{"z": 60, "simbolo": "Nd", "nome": "Neodímio", "mm":144.242},
			{"z": 61, "simbolo": "Pm", "nome": "Promécio", "mm":145},
			{"z": 62, "simbolo": "Sm", "nome": "Samário", "mm":150.36},
			{"z": 63, "simbolo": "Eu", "nome": "Európio", "mm":151.964},
			{"z": 64, "simbolo": "Gd", "nome": "Gadolínio", "mm":157.25},
			{"z": 65, "simbolo": "Tb", "nome": "Térbio", "mm":158.92535},
			{"z": 66, "simbolo": "Dy", "nome": "Disprósio", "mm":162.5},
			{"z": 67, "simbolo": "Ho", "nome": "Hólmio", "mm":164.93032},
			{"z": 68, "simbolo": "Er", "nome": "Érbio", "mm":167.259},
			{"z": 69, "simbolo": "Tm", "nome": "Túlio", "mm":168.93421},
			{"z": 70, "simbolo": "Yb", "nome": "Itérbio", "mm":173.054},
			{"z": 71, "simbolo": "Lu", "nome": "Lutécio", "mm":174.9668},
			{"z": 89, "simbolo": "Ac", "nome": "Actínio", "mm":227},
			{"z": 90, "simbolo": "Th", "nome": "Tório", "mm":232.03806},
			{"z": 91, "simbolo": "Pa", "nome": "Protactínio", "mm":231.03588},
			{"z": 92, "simbolo": "U", "nome": "Urânio", "mm":238.02891},
			{"z": 93, "simbolo": "Np", "nome": "Neptúnio", "mm":237},
			{"z": 94, "simbolo": "Pu", "nome": "Plutônio", "mm":244},
			{"z": 95, "simbolo": "Am", "nome": "Amerício", "mm":243},
			{"z": 96, "simbolo": "Cm", "nome": "Cúrio", "mm":247},
			{"z": 97, "simbolo": "Bk", "nome": "Berquélio", "mm":247},
			{"z": 98, "simbolo": "Cf", "nome": "Califórnio", "mm":251},
			{"z": 99, "simbolo": "Es", "nome": "Einstênio", "mm":252},
			{"z": 100, "simbolo": "Fm", "nome": "Férmio", "mm":257},
			{"z": 101, "simbolo": "Md", "nome": "Mendelévio", "mm":258},
			{"z": 102, "simbolo": "No", "nome": "Nobélio", "mm":259},
			{"z": 103, "simbolo": "Lr", "nome": "Laurêncio", "mm":262},
		];
		elementos.sort(function(a, b) {
			return (a.simbolo > b.simbolo) ? -1 : ((b.simbolo > a.simbolo) ? 1 : 0);
		});
		//elementos.reverse();
		function getElemento(formula) {
			for (var i = 0; i < elementos.length; i++) {
				var re = new RegExp(elementos[i].simbolo + "+(\\d*)");
				if (formula.search(re) != -1) {
					return elementos[i];
				}
			}
			return false;
		}
		function soma(formula, quantificador) {
			var s = 0;
			var si = 0;
			elemento = getElemento(formula);
			while (elemento) {
					var re = new RegExp(elemento.simbolo + "(\\d*)");
					var temp = formula.match(re);
					formula = formula.replace(re, "");
					si = elemento.mm;
					if (temp[1] != "") si *= parseInt(temp[1]);					
					s += si;
					elemento = getElemento(formula);
			};
			if (quantificador != null) s *= quantificador;
			return s;
		}
		function getMassa(str, precisao) {
			var mm = 0;
			var quantificadorTotal = 1;
			var re = /^(\d+)?\(?(\w+)\)?(\d+)?/;
			while (str.match(re)) {
				var temp = re.exec(str);
				if (temp[1] != null) {
					quantificadorTotal = parseInt(temp[0]);
				}
				var elems = temp[2];
				var quantificador = temp[3];
				mm += soma(elems, quantificador);
				str = str.replace(re, "");
			}
			mm *= quantificadorTotal;			
			var grandeza = (quantificadorTotal == 1) ? "g/mol" : ("g/(" + quantificadorTotal + " mols)");
			return [mm.toFixed(precisao).replace(".", ","), grandeza];
		}
		window.onload = function() {
			var expressao = document.getElementById("expressao");
			var mm = document.getElementById("mm");
			var s = document.getElementById("salvar");
			var table = document.getElementsByTagName("table")[0];
			var precisao = document.getElementById("precisao");
			var result;
			var salvar = function() {
				result = getMassa(expressao.value, parseInt(precisao.value));
				var r = result[0];
				var g = result[1];
				var f = expressao.value;
				if (f != "") {
					var tr = document.createElement("tr");
					var tdF = document.createElement("td");
					var tdR = document.createElement("td");
					var tdG = document.createElement("td");
					var btn = document.createElement("button");
					tdR.setAttribute("class", "direita");
					tdF.setAttribute("class", "esquerda");
					tdG.setAttribute("class", "esquerda");
					btn.innerHTML = "x";
					btn.addEventListener("click", function() {
						table.removeChild(tr);
					});
					tdF.innerHTML = "<b>" + f + "</b>";
					tdR.innerHTML = r;
					tdG.innerHTML = g;
					tdF.appendChild(btn);
					tr.appendChild(tdF);
					tr.appendChild(tdR);
					tr.appendChild(tdG);

					table.appendChild(tr);
					expressao.value = "";
					mm.value = "";
				}
			};
			var obterMMTotal = function() {
				result = getMassa(expressao.value, parseInt(precisao.value));
				mm.value = result[0] + " " + result[1];
			}
			s.addEventListener("click", salvar);
			expressao.addEventListener("keyup", function(e) {
				obterMMTotal();
				if (e.keyCode == 13) {
					salvar();
				}
			});
			precisao.addEventListener("change", function(e) {
				obterMMTotal();
			});
			document.body.insertBefore(menubar, document.body.firstElementChild);
			document.body.appendChild(footbar);
		}
		</script>
	</head>
	<body>
		<div id="container">
			<h1>Calcular MM</h1>
			<input type="text" id="expressao" placeholder="Fórmula Química" autofocus><br>
			<input type="text" id="mm" value="0,000 g/mol"/><br>
			<span>Número de casas decimais:<span> <select id="precisao">
				<option value="0">0</option>
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3" selected>3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7">7</option>
				<option value="8">8</option>
				
			</select><br>
			<button id="salvar">Salvar</button><br>
			<table border="1">
				<tr><th>Fórmula</th><th>Massa</th><th>Grandeza</th></tr>
			</table><br>
			<small>
				Valores das massas molares de cada elemento<br>
				extraídos do site: 
				<a target="_blank" href="https://www.tabelaperiodicacompleta.com/">Tabela Periódica Completa</a>
			</small>
		</div>
	</body>
</html>
