<DOCTYPE html>
<html lang="pt-br">
	<head>
		<title>Dividir em Grupos</title>
		<meta name="viewport" content="width=device-width">
		<script>
		function removeById(indice,  array) {
			var new_array = [];
			for (var i = 0; i < array.length; i++) {
				if (i == indice) continue;
				new_array.push(array[i]);
			}
			return new_array;
		}
		function removeByValue(value,  array) {
			var new_array = [];
			for (var i = 0; i < array.length; i++) {
				if (array[i] == value) continue;
				new_array.push(array[i]);
			}
			return new_array;
		}		
		function getGroups(nGroups, array) {
			var choice;
			var qtdGroup = Math.floor(array.length / nGroups);
			var groups = Array();
			for (var i = 0; i < nGroups; i++) {
				groups[i] = [];
				for (var j = 0; j < qtdGroup; j++) {
					choice = Math.floor(Math.random() * array.length);
					groups[i][j] = array[choice];
					array = removeById(choice, array);
				}
			}
			var al = array.length;
			if (al > 0) {
				for (var i = 0; i < al; i++) {
					choice = Math.floor(Math.random() * array.length);
					groups[i].push(array[choice]);
					array = removeById(choice, array);
				}
			}
			return groups;
		}
		var participants = [];
		var subjects = [];
		window.onload = function() {
			var inputName = document.getElementById("name");
			var boxParticipants = document.getElementById("boxParticipants");
			var btnCreateGroups = document.getElementById("createGroups");
			var inputSubject = document.getElementById("subject");
			var boxSubjects = document.getElementById("boxSubjects");
			var boxGroups = document.getElementById("boxGroups");
			var btnAddNome = document.getElementById("btnAddNome");
			var boxInfo = document.getElementById("info");
			var cleanInput = function() {
				inputName.value = "";
				inputSubject.value = "";
			}
			var cleanGroups = function() {
				boxGroups.innerHTML = "";
			}
			var addNome = function() {
				var nome = inputName.value;
				if (nome != "") {
					var li = document.createElement("li");
					var btn = document.createElement("button");
					btn.setAttribute("class", "btn-close");
					var span = document.createElement("span");
					btn.innerHTML = "x";
					btn.addEventListener("click", function() {
						var s = li.getElementsByTagName("span")[0];
						participants = removeByValue(nome, participants);
						boxParticipants.removeChild(li);
					});
					span.innerHTML = nome + " ";
					li.appendChild(span);
					li.appendChild(btn);
					participants.push(inputName.value);
					boxParticipants.appendChild(li);
					cleanInput();
				}
			}
			var addSubject = function() {
				var subject = inputSubject.value;
				if (subject != "") {
					var li = document.createElement("li");
					var btn = document.createElement("button");
					btn.setAttribute("class", "btn-close");
					var span = document.createElement("span");
					btn.innerHTML = "x";
					btn.addEventListener("click", function() {
						var s = li.getElementsByTagName("span")[0];
						subjects = removeByValue(subject, subjects);
						boxSubjects.removeChild(li);
					});
					span.innerHTML = subject + " ";
					li.appendChild(span);
					li.appendChild(btn);
					subjects.push(inputSubject.value);
					boxSubjects.appendChild(li);
					cleanInput();
				}
				/*
				var input = document.createElement("input");
				input.setAttribute("class", "subject");
				var btn = document.createElement("button");
				btn.innerHTML = "x";
				btn.setAttribute("class", "btn-close");
				btn.addEventListener("click", function() {
					boxSubjects.removeChild(input);
					boxSubjects.removeChild(btn);
				});

				boxSubjects.appendChild(input);
				boxSubjects.appendChild(btn);
				*/
			}
			btnAddSubject.addEventListener("click", addSubject);
			btnAddNome.addEventListener("click", addNome);
			inputName.addEventListener("keyup", function(e) {
				if (e.keyCode == 13) {
					addNome();
				}
			});
			inputSubject.addEventListener("keyup", function(e) {
				if (e.keyCode == 13) {
					addSubject();
				}
			});
			btnCreateGroups.addEventListener("click", function() {
				cleanGroups();
				var totalGroups = subjects.length;
				var totalParticipants = participants.length;
				if ((totalParticipants < totalGroups) || (totalGroups < 2) || (totalParticipants < 1)) {
					alert("Quantidade insuficiente!");
					inputName.focus();
				} else {
					boxInfo.innerHTML = "Total de participantes: " + totalParticipants;
					var aSubjects = getGroups(totalGroups, subjects);
					var aParticipants = getGroups(totalGroups, participants);
					for (var i = 0; i < totalGroups; i++) {
						var ul = document.createElement("ul");
						ul.innerHTML = "<b>" + aSubjects[i] + "</b>";
						for (var j = 0; j < aParticipants[i].length; j++) {
							var li = document.createElement("li");
							li.innerHTML = aParticipants[i][j];
							ul.appendChild(li);
						}
						var tLi = document.createElement("li");
						var sLi = document.createElement("small");
						sLi.innerHTML = "Total: " + aParticipants[i].length;
						tLi.appendChild(sLi);
						ul.appendChild(tLi);
						boxGroups.appendChild(ul);
					}
				}
			});
		}
		</script>
		<style>
		* {
			font-family: arial;
		}
		body {
			margin: 0px;
			padding: 0px;
		}
		h1 {
			background: darkblue;
			padding: 10px 2px 10px 2px;
			color: white;
		}
		ul {
			padding: 0px;
			margin: 0px;
		}
		button {
			display: inline-block;
			margin: 5px;
			border-radius: 30px;
			outline: none;
			padding: 5px 10px 5px 10px;
			color: white;
			background:  #0066cc;
			border: none;
			cursor: pointer;
			font-weight: bold;
			clear: both;
		}
		#createGroups {
			background-color: #3333cc;
		}

		#container {
			text-align: center;
		}
		#boxParticipants li, #boxSubjects li {
			display: inline-block;
			list-style: none;
			padding: 0;
			color: red;
			margin: 5px;
		}
		#boxParticipants {
			overflow: auto;
		}
		#name, #subject, .subject {
			padding: 5px;
			border-radius: 10px;
			outline: none;
			text-align: center;
			border: solid 2px gray;
		}
		#qtdGroups {
			width: 75px;
		}
		#boxGroups {
			overflow: auto;
			text-align: center;
		}
		#boxGroups ul {
			border-radius: 10px;
			overflow: hidden;
			display: inline-block;
			vertical-align: middle;
			top: 0px;
			border: solid 2px #006666;
			margin: 0px 10px 10px 10px;
			
		}
		#boxGroups ul li {
			padding: 0px;
			margin: 5px;
			list-style: none;
		}
		.btn-close {
			font-size: 10px;
			font-weight: bold;
			background: gray;
		}
		#author {
			display: block;
			margin: 20px;
		}
		#info {
			text-align: center;
		}
		#boxParticipants, #boxSubjects {
			margin: 5px;
			
			border-radius: 10px;
			padding: 5px;
		}
		.subject {
			margin: 5px;
			width: 200px;
		}
		h4 {
			margin: 10px;
		}
		ul b {
			display: block;
			background: #006666;
			color: white;
			padding: 5px 10px 5px 10px;
		}
		</style>
	</head>
	<body>
		<div id="container">
			<h1>Dividir em Grupos</h1>
			<h4>Participantes</h4>
			<div id="boxAdd">
				<input type="text" id="name" placeholder="Nome do participante" autofocus/><br>
				<button id="btnAddNome">Adicionar</button>
			</div>
			<ul id="boxParticipants">
			</ul>
			<h4>Assuntos</h4>
			<input type="text" id="subject" placeholder="Assunto"/><br>
			<button id="btnAddSubject">Adicionar</button><br>
			<div id="boxSubjects"></div><br>
			<h4>Grupos</h4>
			<div id="boxGroups">
			</div>
			<button id="createGroups">Dividir</button>
			<div id="info">
			
			</div>
			<span id="author"><small>by Milton Rodrigues - iomltn@gmail.com</small></span>
		</div>
	</body>
</html>